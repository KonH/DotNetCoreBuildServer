{
	"args": [
		"tag"
	],
	"log_file": "{root}/full_log.txt",
	"tasks": [
		{
			"show_server_name": {
				"print": {
					"message": "server name is {serverName}"
				}
			}
		},
		{
			"only_on_testServer": {
				"check": {
					"condition": "testServer",
					"value": "{serverName}",
					"silent": "true"
				}
			}	
		},
		{
			"validate_project_root": {
				"check_dir_exist": {
					"path": "{root}",
					"size_more": "1"
				}
			}
		},
		{
			"clean_repo": {
				"run": {
					"path": "git",
					"args": "reset --hard",
					"work_dir": "{root}/git_repo",
					"error_regex": "(error|fatal)"
				}
			}
		},
		{
			"fetch_last_repo": {
				"run": {
					"path": "git",
					"args": "fetch --all",
					"work_dir": "{root}/git_repo",
					"error_regex": "(error|fatal)"
				}
			}
		},
		{
			"checkout_to_commit": {
				"run": {
					"path": "git",
					"args": "checkout {tag}",
					"work_dir": "{root}/git_repo",
					"error_regex": "(error|fatal)"
				}
			}
		},
		{
			"validate_sources": {
				"check_file_exist": {
					"path": "{root}/git_repo/sources.txt"
				}
			}
		},
		{
			"clean_project": {
				"delete_file": {
					"path": "{root}/build.txt",
					"if_exist": "true"
				}
			}
		},
		{
			"show_project_root": {
				"run": {
					"path": "ls",
					"args": "{root}"
				}
			}
		},
		{
			"make_build": {
				"run": {
					"path": "{root}/git_repo/run.sh",
					"work_dir": "{root}/git_repo",
					"log_file": "{root}/build_log.txt"
				}
			}
		},
		{
			"validate_build": {
				"check_file_exist": {
					"path": "{root}/build.txt",
					"size_more": "1"
				}
			}
		},
		{
			"clean_upload": {
				"run": {
					"path": "svn",
					"args": "cleanup",
					"work_dir": "{root}/local_svn",
					"error_regex": "error"
				}
			}
		},
		{
			"update_upload": {
				"run": {
					"path": "svn",
					"args": "update",
					"work_dir": "{root}/local_svn",
					"error_regex": "error"
				}
			}
		},
		{
			"copy_to_upload": {
				"copy_file": {
					"from": "{root}/build.txt",
					"to": "{root}/local_svn/build.txt"
				}
			}
		},
		{
			"add_build": {
				"run": {
					"path": "svn",
					"args": "add . --force",
					"work_dir": "{root}/local_svn",
					"error_regex": "error"
				}
			}
		},
		{
			"upload_build": {
				"run": {
					"path": "svn",
					"args": "commit -m \"Build for {tag}.\"",
					"work_dir": "{root}/local_svn",
					"error_regex": "(error|Commit failed)",
					"log_file": "{root}/upload_log.txt",
					"result_regex": "(?<=Committed revision )([0-9]*)"
				}
			}
		},
		{
			"make_new_dir": {
				"make_dir": {
					"path": "{root}/newDirectory"
				}
			}
		},
		{
			"make_new_file": {
				"make_file": {
					"path": "{root}/newFile.txt",
					"content": "{upload_build:message}"
				}
			}	
		},
		{
			"build_report": {
				"print": {
					"message": "Build result rev.{upload_build:result}"
				}
			}
		}
	]
}